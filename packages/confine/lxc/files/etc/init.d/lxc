#!/bin/sh /etc/rc.common


START=80

#EXTRA_COMMANDS=""



start() {

    lxc.lib system_init

    local SL_NAME=

    for SL_NAME in $( uci -q show lxc || true | grep -e "=container$" | awk -F'=' '{print $1}' | awk -F'lxc.' '{print $2 }' | grep -v '\.' ); do

	if [ "$( uci -q get lxc.$SL_NAME.container_id || true )" = "${SL_NAME:0:2}" ] && [ "$( uci -q get lxc.$SL_NAME.auto_boot || true )" = "1" ]; then
	    lxc.lib sl_start $SL_NAME
	fi
	
    done
}


stop() {

    lxc.lib system_init

    local SL_NAME=

    for SL_NAME in $( lxc-ls ); do

	local SL_TYPE="$( uci -q get lxc.$SL_NAME || true )"

	if [ "$SL_TYPE" = "container" ]; then
	    if lxc-info -n $SL_NAME 2>/dev/null | grep -e "^state:" | grep -e "RUNNING" >/dev/null ;then
	      	lxc.lib sl_stop $SL_NAME
	    fi
	fi
    done

    lxc.lib check_bridge_ifnames "sl-" reset
}
