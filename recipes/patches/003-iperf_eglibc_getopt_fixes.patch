diff -Nur packages/openwrt/net/iperf.orig/Makefile packages/openwrt/net/iperf/Makefile
--- packages/openwrt/net/iperf.orig/Makefile	2012-02-25 16:09:24.492441240 +0100
+++ packages/openwrt/net/iperf/Makefile	2012-02-25 15:18:18.692498688 +0100
@@ -23,7 +23,7 @@
 define Package/iperf/Default
   SECTION:=net
   CATEGORY:=Network
-  DEPENDS:= +uclibcxx
+  DEPENDS:= +USE_UCLIBC:uclibcxx +!USE_UCLIBC:libstdcpp
   TITLE:=Internet Protocol bandwidth measuring tool
   URL:=http://sourceforge.net/projects/iperf/
 endef
@@ -67,7 +67,9 @@
   CONFIGURE_VARS += ac_cv_func_pthread_cancel=no
 endif
 
+ifdef CONFIG_USE_UCLIBC
 TARGET_CXX=g++-uc
+endif
 
 CONFIGURE_VARS += CXXFLAGS="$$$$CXXFLAGS -fno-rtti"
 
diff -Nur packages/openwrt/net/iperf.orig/patches/002-fix_gnugetopt_h.patch packages/openwrt/net/iperf/patches/002-fix_gnugetopt_h.patch
--- packages/openwrt/net/iperf.orig/patches/002-fix_gnugetopt_h.patch	1970-01-01 01:00:00.000000000 +0100
+++ packages/openwrt/net/iperf/patches/002-fix_gnugetopt_h.patch	2012-02-25 15:59:41.264452169 +0100
@@ -0,0 +1,34 @@
+--- a/include/gnu_getopt.h
++++ b/include/gnu_getopt.h
+@@ -30,8 +30,8 @@
+  * $Id: gnu_getopt.h,v 1.1.1.1 2004/05/18 01:50:44 kgibbs Exp $
+  */
+ 
+-#ifndef _GETOPT_H
+-    #define _GETOPT_H 1
++#ifndef _GNU_GETOPT_H
++    #define _GNU_GETOPT_H 1
+ 
+     #ifdef	__cplusplus
+ extern "C" {
+@@ -92,12 +92,14 @@ extern int gnu_optopt;
+ /* has_arg can't be an enum because some compilers complain about
+    type mismatches in all the code that assumes it is an int.  */
+ 
++#ifndef _GETOPT_H
+ struct option {
+     const char *name;
+     int has_arg;
+     int *flag;
+     int val;
+ };
++#endif
+ 
+ /* Names for the values of the `has_arg' field of `struct option'.  */
+ 
+@@ -133,4 +135,4 @@ int _gnu_getopt_internal( int argc,
+ } /* end extern "C" */
+     #endif
+ 
+-#endif /* _GETOPT_H */
++#endif /* _GNU_GETOPT_H */
